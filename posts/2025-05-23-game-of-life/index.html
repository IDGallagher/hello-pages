<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Loadingâ€¦</title>
  <link rel="stylesheet" href="/global.css" />
  <script type="module" src="/post-init.js"></script>
  <style>
    #life-canvas { width: 500px; height: 500px; display:block; margin:1rem auto; }
  </style>
</head>

<body>
  <site-header brand="My Blog" sticky></site-header>
  <post-hero></post-hero>

  <main class="post-main">
    <p>A simple demo of Conway's Game of Life rendered with three.js.</p>
    <canvas id="life-canvas"></canvas>
  </main>
  <site-footer></site-footer>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

    const size = 50;
    const canvas = document.getElementById('life-canvas');
    const renderer = new THREE.WebGLRenderer({ canvas });
    renderer.setSize(canvas.clientWidth, canvas.clientHeight);

    const scene = new THREE.Scene();
    const camera = new THREE.OrthographicCamera(-size/2, size/2, size/2, -size/2, 0.1, 10);
    camera.position.z = 5;

    const geometry = new THREE.PlaneGeometry(1, 1);
    const cells = [];
    for (let y = 0; y < size; y++) {
      cells[y] = [];
      for (let x = 0; x < size; x++) {
        const material = new THREE.MeshBasicMaterial({ color: 0x000000 });
        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(x - size/2 + 0.5, y - size/2 + 0.5, 0);
        scene.add(mesh);
        cells[y][x] = { mesh, alive: Math.random() > 0.7 };
        mesh.material.color.set(cells[y][x].alive ? 0x00ff00 : 0x000000);
      }
    }

    function countAlive(x, y) {
      let total = 0;
      for (let j = -1; j <= 1; j++) {
        for (let i = -1; i <= 1; i++) {
          if (i === 0 && j === 0) continue;
          const nx = (x + i + size) % size;
          const ny = (y + j + size) % size;
          if (cells[ny][nx].alive) total++;
        }
      }
      return total;
    }

    function step() {
      const next = [];
      for (let y = 0; y < size; y++) {
        next[y] = [];
        for (let x = 0; x < size; x++) {
          const alive = cells[y][x].alive;
          const n = countAlive(x, y);
          next[y][x] = n === 3 || (alive && n === 2);
        }
      }
      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          cells[y][x].alive = next[y][x];
          cells[y][x].mesh.material.color.set(next[y][x] ? 0x00ff00 : 0x000000);
        }
      }
    }

    let last = 0;
    function animate(ms) {
      requestAnimationFrame(animate);
      if (ms - last > 200) { step(); last = ms; }
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
